
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Budgeting Monthly Tracker</title>
</head>
<body
  style="
    margin:0;
    min-height:100vh;
    display:grid;
    grid-template-rows:1fr auto;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color:#ffffff;
    background:
      linear-gradient(180deg, rgba(8,17,28,0.80), rgba(8,17,28,0.85)),
      url('https://images.unsplash.com/photo-1543512218-d4d483b70f37?auto=format&fit=crop&w=1800&q=80')
      center/cover no-repeat fixed;
  "
>
  <!-- Centered wrapper -->
  <div style="display:flex;align-items:center;justify-content:center;padding:48px 16px;">
    <div style="width:100%;max-width:1040px;">
      <h1 style="margin:0 0 8px 0;font-weight:700;text-align:center;">Budgeting Monthly Tracker</h1>
      <p style="text-align:center;color:#cbd5e1;font-size:14px;margin:0 0 18px 0;">
        A minimal, experimentative budgeting tool for living in London.
      </p>

      <!-- Glass card -->
      <div
        style="
          background:rgba(255,255,255,0.08);
          backdrop-filter:blur(12px);
          -webkit-backdrop-filter:blur(12px);
          border-radius:20px;
          padding:24px;
          border:1px solid rgba(255,255,255,0.18);
          box-shadow:0 10px 30px rgba(0,0,0,0.35);
        "
      >
        <!-- Top bar -->
        <div style="display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-bottom:14px;">
          <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;">
            <label style="display:flex;gap:10px;align-items:center;padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,0.18);background:rgba(255,255,255,0.08);">
              <span>Month</span>
              <input id="monthInput" type="month"
                style="padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.18);background:rgba(255,255,255,0.10);color:#fff;">
            </label>
            <span style="color:#cbd5e1;font-size:12px;">Pick the month you're budgeting for</span>
          </div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;">
            <button id="resetBtn"
              style="padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,0.22);background:rgba(255,255,255,0.16);color:#fff;cursor:pointer;">
              Reset
            </button>
            <button id="exportBtn"
              style="padding:12px 14px;border-radius:12px;border:none;background:#0ea5e9;color:#082032;font-weight:600;cursor:pointer;">
              Export CSV
            </button>
          </div>
        </div>

        <!-- Layout grid: 3 columns -->
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:18px;">
          <!-- Core Monthly Bills (Shared) -->
          <div>
            <h3 style="margin:0 0 10px 0;">Core Monthly Bills</h3>

            <!-- Utility to render a £ input (duplicated inline styles for reliability) -->
            <div style="margin-bottom:12px;">
              <label style="display:block;margin-bottom:8px;">Rent</label>
              <div style="position:relative;">
                <span style="position:absolute;left:10px;top:50%;transform:translateY(-50%);color:#93c5fd;font-weight:600;">£</span>
                <input id="rent" type="number" step="0.01" min="0" inputmode="decimal" placeholder="0.00"
                  style="width:100%;padding:14px 12px 14px 38px;border-radius:12px;border:1px solid rgba(255,255,255,0.18);background:rgba(255,255,255,0.10);color:#fff;">
              </div>
            </div>

            <div style="margin-bottom:12px;">
              <label style="display:block;margin-bottom:8px;">Council Tax</label>
              <div style="position:relative;">
                <span style="position:absolute;left:10px;top:50%;transform:translateY(-50%);color:#93c5fd;font-weight:600;">£</span>
                <input id="council" type="number" step="0.01" min="0" inputmode="decimal" placeholder="0.00"
                  style="width:100%;padding:14px 12px 14px 38px;border-radius:12px;border:1px solid rgba(255,255,255,0.18);background:rgba(255,255,255,0.10);color:#fff;">
              </div>
            </div>

            <div style="margin-bottom:12px;">
              <label style="display:block;margin-bottom:8px;">Electricity</label>
              <div style="position:relative;">
                <span style="position:absolute;left:10px;top:50%;transform:translateY(-50%);color:#93c5fd;font-weight:600;">£</span>
                <input id="electricity" type="number" step="0.01" min="0" inputmode="decimal" placeholder="0.00"
                  style="width:100%;padding:14px 12px 14px 38px;border-radius:12px;border:1px solid rgba(255,255,255,0.18);background:rgba(255,255,255,0.10);color:#fff;">
              </div>
            </div>

            <div style="margin-bottom:12px;">
              <label style="display:block;margin-bottom:8px;">Gas</label>
              <div style="position:relative;">
                <span style="position:absolute;left:10px;top:50%;transform:translateY(-50%);color:#93c5fd;font-weight:600;">£</span>
                <input id="gas" type="number" step="0.01" min="0" inputmode="decimal" placeholder="0.00"
                  style="width:100%;padding:14px 12px 14px 38px;border-radius:12px;border:1px solid rgba(255,255,255,0.18);background:rgba(255,255,255,0.10);color:#fff;">
              </div>
            </div>

            <div style="margin-bottom:12px;">
              <label style="display:block;margin-bottom:8px;">Water</label>
              <div style="position:relative;">
                <span style="position:absolute;left:10px;top:50%;transform:translateY(-50%);color:#93c5fd;font-weight:600;">£</span>
                <input id="water" type="number" step="0.01" min="0" inputmode="decimal" placeholder="0.00"
                  style="width:100%;padding:14px 12px 14px 38px;border-radius:12px;border:1px solid rgba(255,255,255,0.18);background:rgba(255,255,255,0.10);color:#fff;">
              </div>
            </div>

            <div style="margin-bottom:12px;">
              <label style="display:block;margin-bottom:8px;">Wi‑Fi / Broadband</label>
              <div style="position:relative;">
                <span style="position:absolute;left:10px;top:50%;transform:translateY(-50%);color:#93c5fd;font-weight:600;">£</span>
                <input id="wifi" type="number" step="0.01" min="0" inputmode="decimal" placeholder="0.00"
                  style="width:100%;padding:14px 12px 14px 38px;border-radius:12px;border:1px solid rgba(255,255,255,0.18);background:rgba(255,255,255,0.10);color:#fff;">
              </div>
            </div>

            <div style="margin-bottom:12px;">
              <label style="display:block;margin-bottom:8px;">Phone Bill</label>
              <div style="position:relative;">
                <span style="position:absolute;left:10px;top:50%;transform:translateY(-50%);color:#93c5fd;font-weight:600;">£</span>
                <input id="phone" type="number" step="0.01" min="0" inputmode="decimal" placeholder="0.00"
                  style="width:100%;padding:14px 12px 14px 38px;border-radius:12px;border:1px solid rgba(255,255,255,0.18);background:rgba(255,255,255,0.10);color:#fff;">
              </div>
            </div>
          </div>

          <!-- Subscriptions (Shared) -->
          <div>
            <h3 style="margin:0 0 10px 0;">Subscriptions</h3>

            <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
              <label><input type="checkbox" id="subNetflix"> Netflix</label>
              <input id="subNetflixAmt" type="number" step="0.01" min="0" value="10.99"
                     style="width:110px;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.22);background:rgba(255,255,255,0.10);color:#fff;">
            </div>
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
              <label><input type="checkbox" id="subDisney"> Disney+</label>
              <input id="subDisneyAmt" type="number" step="0.01" min="0" value="7.99"
                     style="width:110px;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.22);background:rgba(255,255,255,0.10);color:#fff;">
            </div>
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
              <label><input type="checkbox" id="subPrime"> Amazon Prime</label>
              <input id="subPrimeAmt" type="number" step="0.01" min="0" value="8.99"
                     style="width:110px;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.22);background:rgba(255,255,255,0.10);color:#fff;">
            </div>
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
              <label><input type="checkbox" id="subSpotify"> Spotify</label>
              <input id="subSpotifyAmt" type="number" step="0.01" min="0" value="11.99"
                     style="width:110px;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.22);background:rgba(255,255,255,0.10);color:#fff;">
            </div>

            <!-- Dropdown + add custom subscription -->
            <div style="display:flex;gap:10px;align-items:center;margin-top:12px;">
              <select id="subSelect"
                      style="flex:1;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.22);background:rgba(255,255,255,0.10);color:#fff;">
                <option value="">Choose a subscription to add…</option>
                <option value="Apple TV+|8.99">Apple TV+ (£8.99)</option>
                <option value="YouTube Premium|12.99">YouTube Premium (£12.99)</option>
                <option value="Google One / iCloud|1.99">Google One / iCloud (£1.99)</option>
                <option value="Gym|25.00">Gym (£25.00)</option>
              </select>
              <button id="addSubBtn"
                style="padding:10px 12px;border-radius:10px;border:1px dashed rgba(255,255,255,0.30);background:transparent;color:#fff;cursor:pointer;">
                + Add
              </button>
            </div>
            <div id="subsCustom" style="display:flex;flex-direction:column;gap:10px;margin-top:10px;"></div>
          </div>

          <!-- Couple Household & Income -->
          <div>
            <h3 style="margin:0 0 10px 0;">Couple Household & Income</h3>

            <!-- Shared household in this section -->
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
              <label>Household Supplies</label>
              <input id="hhSuppliesAmt" type="number" step="0.01" min="0" value="0"
                     style="flex:1;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.22);background:rgba(255,255,255,0.10);color:#fff;">
            </div>
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
              <label>Contents Insurance</label>
              <input id="hhInsuranceAmt" type="number" step="0.01" min="0" value="0"
                     style="flex:1;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.22);background:rgba(255,255,255,0.10);color:#fff;">
            </div>
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
              <label>Groceries</label>
              <input id="groceries" type="number" step="0.01" min="0" value="0"
                     style="flex:1;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.22);background:rgba(255,255,255,0.10);color:#fff;">
            </div>
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;">
              <label>Transport (Oyster/Travel)</label>
              <input id="transport" type="number" step="0.01" min="0" value="0"
                     style="flex:1;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.22);background:rgba(255,255,255,0.10);color:#fff;">
            </div>

            <!-- Per-person CC repayments for savings -->
            <div style="margin-top:6px;color:#cbd5e1;font-size:12px;">Per‑person monthly credit card repayments</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:6px;">
              <div style="position:relative;">
                <label style="display:block;margin-bottom:6px;">Your credit card</label>
                <span style="position:absolute;left:10px;top:46px;transform:translateY(-50%);color:#93c5fd;font-weight:600;">£</span>
                <input id="ccYou" type="number" step="0.01" min="0"
                  style="width:100%;padding:14px 12px 14px 38px;border-radius:12px;border:1px solid rgba(255,255,255,0.18);background:rgba(255,255,255,0.10);color:#fff;">
              </div>
              <div style="position:relative;">
                <label style="display:block;margin-bottom:6px;">Partner credit card</label>
                <span style="position:absolute;left:10px;top:46px;transform:translateY(-50%);color:#93c5fd;font-weight:600;">£</span>
                <input id="ccPartner" type="number" step="0.01" min="0"
                  style="width:100%;padding:14px 12px 14px 38px;border-radius:12px;border:1px solid rgba(255,255,255,0.18);background:rgba(255,255,255,0.10);color:#fff;">
              </div>
            </div>

            <!-- Salaries -->
            <div style="margin-top:12px;color:#cbd5e1;font-size:12px;">Monthly salaries</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:6px;">
              <div style="position:relative;">
                <label style="display:block;margin-bottom:6px;">Your salary</label>
                <span style="position:absolute;left:10px;top:46px;transform:translateY(-50%);color:#93c5fd;font-weight:600;">£</span>
                <input id="salaryYou" type="number" step="0.01" min="0"
                  style="width:100%;padding:14px 12px 14px 38px;border-radius:12px;border:1px solid rgba(255,255,255,0.18);background:rgba(255,255,255,0.10);color:#fff;">
              </div>
              <div style="position:relative;">
                <label style="display:block;margin-bottom:6px;">Partner salary</label>
                <span style="position:absolute;left:10px;top:46px;transform:translateY(-50%);color:#93c5fd;font-weight:600;">£</span>
                <input id="salaryPartner" type="number" step="0.01" min="0"
                  style="width:100%;padding:14px 12px 14px 38px;border-radius:12px;border:1px solid rgba(255,255,255,0.18);background:rgba(255,255,255,0.10);color:#fff;">
              </div>
            </div>
          </div>
        </div>

        <!-- Split controls -->
        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:16px;">
          <label><input id="partnerToggle" type="checkbox"> Add partner split</label>
          <label style="display:flex;gap:6px;align-items:center;padding:6px 10px;border-radius:999px;border:1px dashed rgba(255,255,255,0.30);">
            <input type="radio" name="splitType" id="splitEqual" value="equal" checked> Equal
          </label>
          <label style="display:flex;gap:6px;align-items:center;padding:6px 10px;border-radius:999px;border:1px dashed rgba(255,255,255,0.30);">
            <input type="radio" name="splitType" id="splitPercent" value="percent"> Percentage
          </label>
          <div id="percentRow" style="display:none;color:#cbd5e1;font-size:12px;">
            <span>Your share %</span>
            <input id="youPct" type="number" min="0" max="100" step="1" value="50"
              style="width:80px;margin-left:8px;padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.18);background:rgba(255,255,255,0.10);color:#fff;">
            <span style="margin-left:8px;">Partner % = <span id="partnerPctText">50</span></span>
          </div>
        </div>

        <!-- Extras -->
        <div style="margin-top:16px;">
          <h3 style="margin:0 0 8px 0;">Extra Expenses</h3>
          <div id="extras"></div>
          <div style="display:flex;gap:10px;margin-top:8px;">
            <button id="addExtraBtn"
              style="padding:12px 14px;border-radius:12px;border:1px dashed rgba(255,255,255,0.30);background:transparent;color:#fff;cursor:pointer;">
              + Add extra
            </button>
          </div>
          <div style="color:#cbd5e1;font-size:12px;margin-top:6px;">Add custom lines (e.g., books, societies, gifts).</div>
        </div>

        <!-- Bottom actions -->
        <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:16px;">
          <button id="calcBtn"
            style="padding:12px 14px;border-radius:12px;border:none;background:#0ea5e9;color:#082032;font-weight:600;cursor:pointer;">
            Calculate
          </button>
          <button id="togglePanelBtn"
            style="padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,0.22);background:rgba(255,255,255,0.16);color:#fff;cursor:pointer;">
            View Results
          </button>
          <button id="showChartBtn"
            style="padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,0.22);background:rgba(255,255,255,0.16);color:#fff;cursor:pointer;">
            Generate Pie Chart
          </button>
        </div>

        <!-- Inline results summary -->
        <div id="inlineResults" style="margin-top:12px;text-align:center;color:#e5e7eb;">
          <div>Monthly total: <strong id="inlineMonthly">£0.00</strong></div>
          <div>Yearly total: <strong id="inlineYearly">£0.00</strong></div>
          <div style="margin-top:6px;">Combined salary: <strong id="inlineIncome">£0.00</strong></div>
          <div>Estimated monthly savings: <strong id="inlineSavings">£0.00</strong></div>
          <div id="inlineSplitSavings" style="display:none;margin-top:4px;">
            Your savings: <strong id="inlineYourSavings">£0.00</strong> ·
            Partner savings: <strong id="inlinePartnerSavings">£0.00</strong>
          </div>
        </div>

        <!-- Visualisation -->
        <div style="margin-top:18px;">
          <h3 style="margin:0 0 8px 0;">Visualisation</h3>
          <div style="display:grid;grid-template-columns: 340px 1fr; gap:16px; align-items:center;">
            <canvas id="pieCanvas" width="340" height="340"
              style="background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.18);border-radius:12px;"></canvas>
            <div id="pieLegend" style="font-size:14px;color:#e5e7eb;"></div>
          </div>
          <div style="color:#cbd5e1;font-size:12px;margin-top:6px;">
            Chart shows category shares: Core Bills, Subscriptions, Couple Household, Your CC, Partner CC, Extras.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Floating Results -->
  <button id="fabBtn"
    style="position:fixed;bottom:22px;right:22px;padding:12px 14px;border-radius:999px;border:none;background:#0ea5e9;color:#082032;font-weight:600;cursor:pointer;box-shadow:0 10px 30px rgba(0,0,0,0.35);">
    Results
  </button>
  <div id="panel"
    style="position:fixed;bottom:90px;right:22px;max-width:420px;background:rgba(255,255,255,0.10);backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,0.20);border-radius:16px;padding:16px;display:none;">
    <div style="font-weight:600;margin-bottom:8px;">
      Results <span id="monthLabel" style="color:#cbd5e1;font-size:12px;"></span>
    </div>
    <div style="display:flex;justify-content:space-between;margin:6px 0;"><span>Monthly total</span><strong id="monthlyTotal">£0.00</strong></div>
    <div style="display:flex;justify-content:space-between;margin:6px 0;"><span>Yearly total</span><strong id="yearlyTotal">£0.00</strong></div>
    <div style="display:flex;justify-content:space-between;margin:6px 0;"><span>Combined salary</span><strong id="combinedIncome">£0.00</strong></div>
    <div style="display:flex;justify-content:space-between;margin:6px 0;"><span>Estimated monthly savings</span><strong id="combinedSavings">£0.00</strong></div>
    <div id="partnerBreak" style="display:none;margin-top:8px;">
      <div style="display:flex;justify-content:space-between;margin:6px 0;"><span>Your share</span><strong id="yourShare">£0.00</strong></div>
      <div style="display:flex;justify-content:space-between;margin:6px 0;"><span>Partner share</span><strong id="partnerShare">£0.00</strong></div>
      <div style="display:flex;justify-content:space-between;margin:6px 0;"><span>Your savings</span><strong id="panelYourSavings">£0.00</strong></div>
      <div style="display:flex;justify-content:space-between;margin:6px 0;"><span>Partner savings</span><strong id="panelPartnerSavings">£0.00</strong></div>
      <div style="color:#cbd5e1;font-size:12px;">Split: <span id="splitDesc">Equal</span></div>
    </div>
  </div>

  <!-- Footer credit -->
  <footer style="text-align:center;padding:14px;color:#cbd5e1;font-size:13px;">
    Created by <strong>Shounak Bhattacharjee</strong> •
    <ttps://uk.linkedin.com/in/shounakbhattacharjee31LinkedIn</a>
  </footer>

  <!-- Inline JS -->
  <script>
    // Helpers
    function byId(id){ return document.getElementById(id); }
    function toGBP(n){ return "£" + (Number(n || 0)).toFixed(2); }
    function num(id){ return parseFloat(byId(id).value) || 0; }
    function toggle(el){ el.style.display = (el.style.display==='none' || el.style.display==='') ? 'block' : 'none'; }

    // Elements
    const extrasEl       = byId('extras');
    const subsCustomEl   = byId('subsCustom');
    const partnerTgl     = byId('partnerToggle');
    const splitEqual     = byId('splitEqual');
    const splitPercent   = byId('splitPercent');
    const percentRow     = byId('percentRow');
    const youPctInput    = byId('youPct');
    const partnerPctText = byId('partnerPctText');
    const panel          = byId('panel');

    // Inline totals
    const inlineMonthly  = byId('inlineMonthly');
    const inlineYearly   = byId('inlineYearly');
    const inlineIncome   = byId('inlineIncome');
    const inlineSavings  = byId('inlineSavings');
    const inlineSplit    = byId('inlineSplitSavings');
    const inlineYourSav  = byId('inlineYourSavings');
    const inlinePartSav  = byId('inlinePartnerSavings');

    // Panel totals
    const monthlyTotalEl = byId('monthlyTotal');
    const yearlyTotalEl  = byId('yearlyTotal');
    const combinedIncomeEl  = byId('combinedIncome');
    const combinedSavingsEl = byId('combinedSavings');
    const monthLabelEl   = byId('monthLabel');
    const yourShareEl    = byId('yourShare');
    const partnerShareEl = byId('partnerShare');
    const panelYourSav   = byId('panelYourSavings');
    const panelPartSav   = byId('panelPartnerSavings');
    const partnerBreakEl = byId('partnerBreak');
    const splitDescEl    = byId('splitDesc');

    // Chart
    const pieCanvas = byId('pieCanvas');
    const pieLegend = byId('pieLegend');
    const ctx = pieCanvas.getContext('2d');

    // Extras rows
    function addExtraRow(label='', amount=''){
      const row = document.createElement('div');
      row.style.display = 'grid';
      row.style.gridTemplateColumns = '1.2fr 0.8fr';
      row.style.gap = '12px';
      row.style.marginBottom = '8px';

      const labelInput = document.createElement('input');
      labelInput.type = 'text';
      labelInput.placeholder = 'Label (e.g., Gifts)';
      labelInput.value = label;
      labelInput.style.cssText = 'width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.22);background:rgba(255,255,255,0.10);color:#fff;';
      labelInput.addEventListener('input', calculate);

      const amountInput = document.createElement('input');
      amountInput.type = 'number';
      amountInput.placeholder = '0.00';
      amountInput.min = '0';
      amountInput.step = '0.01';
      amountInput.value = amount;
      amountInput.style.cssText = 'width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.22);background:rgba(255,255,255,0.10);color:#fff;';
      amountInput.addEventListener('input', calculate);

      row.appendChild(labelInput);
      row.appendChild(amountInput);
      extrasEl.appendChild(row);
    }
    addExtraRow(); addExtraRow(); addExtraRow();
    byId('addExtraBtn').addEventListener('click', e => { e.preventDefault(); addExtraRow(); });

    // Custom subscriptions via dropdown
    byId('addSubBtn').addEventListener('click', e=>{
      e.preventDefault();
      const val = byId('subSelect').value;
      if (!val) return;
      const [label, amtStr] = val.split('|');
      const row = document.createElement('div');
      row.style.display = 'grid';
      row.style.gridTemplateColumns = '1.2fr 0.8fr';
      row.style.gap = '12px';
      row.style.marginBottom = '8px';
      row.innerHTML = `
        <input type="text" value="${label}" style="width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.22);background:rgba(255,255,255,0.10);color:#fff;">
        <input type="number" value="${parseFloat(amtStr||'0').toFixed(2)}" step="0.01" min="0" style="width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.22);background:rgba(255,255,255,0.10);color:#fff;">
      `;
      subsCustomEl.appendChild(row);
      Array.from(row.querySelectorAll('input')).forEach(el => el.addEventListener('input', calculate));
      calculate();
    });

    // Percent UI
    function updatePercent(){
      let p = parseFloat(youPctInput.value || 0);
      if (p < 0) p = 0;
      if (p > 100) p = 100;
      youPctInput.value = p;
      partnerPctText.textContent = (100 - p).toFixed(0);
    }
    youPctInput.addEventListener('input', () => { updatePercent(); calculate(); });
    splitPercent.addEventListener('change', () => { percentRow.style.display='block'; calculate(); });
    splitEqual.addEventListener('change', () => { percentRow.style.display='none';  calculate(); });

    // Gatherers
    function gatherSubscriptions(){
      const list = [];
      const subsCb = [
        ['subNetflix','subNetflixAmt','Netflix'],
        ['subDisney','subDisneyAmt','Disney+'],
        ['subPrime','subPrimeAmt','Amazon Prime'],
        ['subSpotify','subSpotifyAmt','Spotify']
      ];
      subsCb.forEach(([cbId, amtId, label])=>{
        if (byId(cbId).checked){
          list.push([label, parseFloat(byId(amtId).value || 0)]);
        }
      });
      // Custom
      list.push(...Array.from(subsCustomEl.children).map(row=>{
        const inputs = row.querySelectorAll('input');
        return [inputs[0].value || 'Subscription', parseFloat(inputs[1].value || 0)];
      }));
      return list;
    }
    function gatherExtras(){
      return Array.from(extrasEl.children).map(row=>{
        const inputs = row.querySelectorAll('input');
        return [inputs[0].value || 'Extra', parseFloat(inputs[1].value || 0)];
      });
    }

    // Calculation
    function calculate(){
      // Shared categories
      const coreBills = [
        ['Rent', num('rent')],
        ['Council Tax', num('council')],
        ['Electricity', num('electricity')],
        ['Gas', num('gas')],
        ['Water', num('water')],
        ['Wi‑Fi', num('wifi')],
        ['Phone Bill', num('phone')],
      ];
      const subs   = gatherSubscriptions(); // array of [label, amount]
      const extras = gatherExtras();

      const coupleHousehold = [
        ['Household Supplies', parseFloat(byId('hhSuppliesAmt').value || 0)],
        ['Contents Insurance', parseFloat(byId('hhInsuranceAmt').value || 0)],
        ['Groceries', parseFloat(byId('groceries').value || 0)],
        ['Transport', parseFloat(byId('transport').value || 0)],
      ];

      const sum = arr => arr.reduce((s, [,v]) => s + Number(v||0), 0);

      const coreTotal  = sum(coreBills);
      const subsTotal  = sum(subs);
      const houseTotal = sum(coupleHousehold);
      const extrasTotal= sum(extras);

      const sharedMonthly = coreTotal + subsTotal + houseTotal + extrasTotal;

      // Per-person individual expenses
      const ccYou     = parseFloat(byId('ccYou').value || 0);
      const ccPartner = parseFloat(byId('ccPartner').value || 0);

      const youIncome     = num('salaryYou');
      const partnerIncome = num('salaryPartner');
      const combinedIncome= youIncome + partnerIncome;

      // Split shared
      let yourShare, partnerShare, splitLabel;
      if (partnerTgl.checked){
        if (splitPercent.checked){
          const youPct = parseFloat(youPctInput.value || 0);
          yourShare    = sharedMonthly * (youPct/100);
          partnerShare = sharedMonthly - yourShare;
          splitLabel   = `Percentage (${youPct}% / ${(100-youPct).toFixed(0)}%)`;
        } else {
          yourShare = partnerShare = sharedMonthly / 2;
          splitLabel = 'Equal (50% / 50%)';
        }
      } else {
        // Not splitting; per‑person figures hidden, but we compute combined savings
        yourShare = partnerShare = 0;
        splitLabel = 'Not applied';
      }

      // Savings
      const yourTotalOut     = yourShare + ccYou;
      const partnerTotalOut  = partnerShare + ccPartner;

      const yourSavings      = youIncome - yourTotalOut;
      const partnerSavings   = partnerIncome - partnerTotalOut;
      const combinedSavings  = combinedIncome - (sharedMonthly + ccYou + ccPartner);

      const monthlyTotal = sharedMonthly + ccYou + ccPartner;
      const yearlyTotal  = monthlyTotal * 12;

      // Inline display
      inlineMonthly.textContent = toGBP(monthlyTotal);
      inlineYearly.textContent  = toGBP(yearlyTotal);
      inlineIncome.textContent  = toGBP(combinedIncome);
      inlineSavings.textContent = toGBP(combinedSavings);

      // Panel display
      monthlyTotalEl.textContent   = toGBP(monthlyTotal);
      yearlyTotalEl.textContent    = toGBP(yearlyTotal);
      combinedIncomeEl.textContent = toGBP(combinedIncome);
      combinedSavingsEl.textContent= toGBP(combinedSavings);

      const m = byId('monthInput').value || '';
      monthLabelEl.textContent = m ? `• ${m}` : '';

      if (partnerTgl.checked){
        partnerBreakEl.style.display = 'block';
        inlineSplit.style.display    = 'block';
        yourShareEl.textContent      = toGBP(yourShare);
        partnerShareEl.textContent   = toGBP(partnerShare);
        panelYourSav.textContent     = toGBP(yourSavings);
        panelPartSav.textContent     = toGBP(partnerSavings);
        inlineYourSav.textContent    = toGBP(yourSavings);
        inlinePartSav.textContent    = toGBP(partnerSavings);
        splitDescEl.textContent      = splitLabel;
      } else {
        partnerBreakEl.style.display = 'none';
        inlineSplit.style.display    = 'none';
      }

      // Chart (aggregated categories)
      const chartItems = [
        ['Core Bills', coreTotal],
        ['Subscriptions', subsTotal],
        ['Couple Household', houseTotal],
        ['Your CC', ccYou],
        ['Partner CC', ccPartner],
        ['Extras', extrasTotal],
      ].filter(([,v]) => Number(v||0) > 0);
      renderPie(chartItems);
    }

    // Pie chart renderer
    const ctx = pieCanvas.getContext('2d');
    function renderPie(items){
      const total = items.reduce((s, [,v]) => s + Number(v||0), 0);
      ctx.clearRect(0,0,pieCanvas.width,pieCanvas.height);

      // Background
      ctx.beginPath();
      ctx.arc(170,170,160,0,Math.PI*2);
      ctx.fillStyle = 'rgba(255,255,255,0.06)';
      ctx.fill();

      if (total <= 0){
        ctx.fillStyle = '#cbd5e1';
        ctx.font = '14px system-ui';
        ctx.fillText('No data to display', 110, 175);
        pieLegend.innerHTML = '<div style="color:#cbd5e1">Add amounts to see the chart.</div>';
        return;
      }

      const colors = ['#60a5fa','#34d399','#fbbf24','#ef4444','#a78bfa','#22d3ee',
                      '#fb7185','#7dd3fc','#f59e0b','#10b981','#eab308','#54c2f7'];

      let start = -Math.PI/2;
      pieLegend.innerHTML = '';
      items.forEach(([label,val], i)=>{
        const angle = (val/total) * Math.PI*2;
        const end   = start + angle;

        ctx.beginPath();
        ctx.moveTo(170,170);
        ctx.arc(170,170,160,start,end);
        ctx.closePath();
        ctx.fillStyle = colors[i % colors.length];
        ctx.fill();

        const sw = `<span style="display:inline-block;width:14px;height:14px;border-radius:3px;background:${colors[i % colors.length]};margin-right:8px;"></span>`;
        pieLegend.insertAdjacentHTML('beforeend', `<div style="margin:4px 0;">${sw}${label}: <strong>${toGBP(val)}</strong></div>`);

        start = end;
      });
    }

    // View/Reset toggles
    byId('fabBtn').addEventListener('click', ()=>toggle(panel));
    byId('togglePanelBtn').addEventListener('click', ()=>toggle(panel));
    byId('showChartBtn').addEventListener('click', ()=>{ renderPie([]); calculate(); });

    byId('resetBtn').addEventListener('click', () => {
      [
        'rent','council','electricity','gas','water','wifi','phone',
        'groceries','transport','hhSuppliesAmt','hhInsuranceAmt',
        'ccYou','ccPartner','salaryYou','salaryPartner'
      ].forEach(id => { byId(id).value=''; });

      // Uncheck subs, reset default amounts
      ['subNetflix','subDisney','subPrime','subSpotify'].forEach(id => byId(id).checked=false);
      ['subNetflixAmt','subDisneyAmt','subPrimeAmt','subSpotifyAmt']
        .forEach(id => byId(id).value = '0');

      byId('monthInput').value = '';
      subsCustomEl.innerHTML = '';
      extrasEl.innerHTML = ''; addExtraRow(); addExtraRow(); addExtraRow();

      partnerTgl.checked = false;
      splitEqual.checked = true; splitPercent.checked = false; percentRow.style.display='none';
      youPctInput.value = 50; updatePercent();

      calculate();
    });

    // Live update wiring
    [
      'monthInput','rent','council','electricity','gas','water','wifi','phone',
      'groceries','transport','hhSuppliesAmt','hhInsuranceAmt',
      'ccYou','ccPartner','salaryYou','salaryPartner',
      'partnerToggle','splitEqual','splitPercent',
      'subNetflix','subDisney','subPrime','subSpotify',
      'subNetflixAmt','subDisneyAmt','subPrimeAmt','subSpotifyAmt'
    ].forEach(id => { const el = byId(id); if (el) el.addEventListener('input', calculate); });
    partnerTgl.addEventListener('change', calculate);
    splitEqual.addEventListener('change', calculate);
    splitPercent.addEventListener('change', calculate);

    // Percent helpers
    function updatePercent(){
      let p = parseFloat(youPctInput.value || 0);
      if (p < 0) p = 0;
      if (p > 100) p = 100;
      youPctInput.value = p;
      partnerPctText.textContent = (100 - p).toFixed(0);
    }

    // Initial render
    function init(){ updatePercent(); calculate(); }
    init();

    // Export CSV
    byId('exportBtn').addEventListener('click', () => {
      const month = byId('monthInput').value || 'Unspecified';

      const rows = [];

      // Inputs summary
      rows.push(['Month', month]);

      rows.push(['Rent', num('rent')]);
      rows.push(['Council Tax', num('council')]);
      rows.push(['Electricity', num('electricity')]);
      rows.push(['Gas', num('gas')]);
      rows.push(['Water', num('water')]);
      rows.push(['Wi‑Fi', num('wifi')]);
      rows.push(['Phone Bill', num('phone')]);

      // Subs (checked + custom summed in chart, but export individually if checked)
      if (byId('subNetflix').checked) rows.push(['Netflix', parseFloat(byId('subNetflixAmt').value||0)]);
      if (byId('subDisney').checked)  rows.push(['Disney+', parseFloat(byId('subDisneyAmt').value||0)]);
      if (byId('subPrime').checked)   rows.push(['Amazon Prime', parseFloat(byId('subPrimeAmt').value||0)]);
      if (byId('subSpotify').checked)  rows.push(['Spotify', parseFloat(byId('subSpotifyAmt').value||0)]);
      Array.from(subsCustomEl.children).forEach(row=>{
        const inputs = row.querySelectorAll('input');
        rows.push([inputs[0].value || 'Subscription', parseFloat(inputs[1].value||0)]);
      });

      // Couple household
      rows.push(['Household Supplies', parseFloat(byId('hhSuppliesAmt').value || 0)]);
      rows.push(['Contents Insurance', parseFloat(byId('hhInsuranceAmt').value || 0)]);
      rows.push(['Groceries', parseFloat(byId('groceries').value || 0)]);
      rows.push(['Transport', parseFloat(byId('transport').value || 0)]);

      // Extras
      Array.from(extrasEl.children).forEach(row=>{
        const inputs = row.querySelectorAll('input');
        rows.push([inputs[0].value || 'Extra', parseFloat(inputs[1].value || 0)]);
      });

      // Salaries + individual CC
      const youInc  = num('salaryYou');
      const prtInc  = num('salaryPartner');
      rows.push(['Your Salary', youInc.toFixed(2)]);
      rows.push(['Partner Salary', prtInc.toFixed(2)]);
      rows.push(['Your Credit Card', (parseFloat(byId('ccYou').value||0)).toFixed(2)]);
      rows.push(['Partner Credit Card', (parseFloat(byId('ccPartner').value||0)).toFixed(2)]);

      // Recompute totals for export
      const valOnly = a => a.reduce((s,[,v]) => s + Number(v||0), 0);
      const coreT  = valOnly([
        ['Rent', num('rent')],['Council Tax', num('council')],['Electricity', num('electricity')],
        ['Gas', num('gas')],['Water', num('water')],['Wi‑Fi', num('wifi')],['Phone Bill', num('phone')],
      ]);
      let subsT = 0;
      if (byId('subNetflix').checked) subsT += parseFloat(byId('subNetflixAmt').value||0);
      if (byId('subDisney').checked)  subsT += parseFloat(byId('subDisneyAmt').value||0);
      if (byId('subPrime').checked)   subsT += parseFloat(byId('subPrimeAmt').value||0);
      if (byId('subSpotify').checked) subsT += parseFloat(byId('subSpotifyAmt').value||0);
      Array.from(subsCustomEl.children).forEach(row=>{
        subsT += parseFloat(row.querySelectorAll('input')[1].value||0);
      });

      const houseT = parseFloat(byId('hhSuppliesAmt').value||0) + parseFloat(byId('hhInsuranceAmt').value||0)
                   + parseFloat(byId('groceries').value||0) + parseFloat(byId('transport').value||0);

      let extrasT = 0;
      Array.from(extrasEl.children).forEach(row=>{
        extrasT += parseFloat(row.querySelectorAll('input')[1].value||0);
      });

      const ccYou     = parseFloat(byId('ccYou').value||0);
      const ccPartner = parseFloat(byId('ccPartner').value||0);

      const sharedMonthly = coreT + subsT + houseT + extrasT;
      const monthlyTotal  = sharedMonthly + ccYou + ccPartner;
      const yearlyTotal   = monthlyTotal * 12;
      const combinedInc   = youInc + prtInc;
      const combinedSav   = combinedInc - monthlyTotal;

      rows.push(['Monthly Total', monthlyTotal.toFixed(2)]);
      rows.push(['Yearly Total', yearlyTotal.toFixed(2)]);
      rows.push(['Combined Salary', combinedInc.toFixed(2)]);
      rows.push(['Estimated Monthly Savings (Combined)', combinedSav.toFixed(2)]);

      if (partnerTgl.checked){
        let yourShare, partnerShare, desc;
        if (splitPercent.checked){
          const youPct = parseFloat(youPctInput.value || 0);
          yourShare    = sharedMonthly * (youPct/100);
          partnerShare = sharedMonthly - yourShare;
          desc = `Percentage (${youPct}% / ${(100-youPct).toFixed(0)}%)`;
        } else {
          yourShare = partnerShare = sharedMonthly/2;
          desc = 'Equal (50% / 50%)';
        }
        const yourSav = youInc - (yourShare + ccYou);
        const prtSav  = prtInc - (partnerShare + ccPartner);

        rows.push(['Split Type', desc]);
        rows.push(['Your Share (Shared Expenses)', yourShare.toFixed(2)]);
        rows.push(['Partner Share (Shared Expenses)', partnerShare.toFixed(2)]);
        rows.push(['Your Total Out (Share + Your CC)', (yourShare + ccYou).toFixed(2)]);
        rows.push(['Partner Total Out (Share + Partner CC)', (partnerShare + ccPartner).toFixed(2)]);
        rows.push(['Your Savings (Monthly)', yourSav.toFixed(2)]);
        rows.push(['Partner Savings (Monthly)', prtSav.toFixed(2)]);
      }

      const csv = 'data:text/csv;charset=utf-8,' + 'Category,Amount (£)\n' + rows.map(r => r.join(',')).join('\n');
      const a = document.createElement('a');
      a.href = encodeURI(csv);
      a.download = `budgeting_monthly_${(byId('monthInput').value||'unspecified').replace(/-/g,'_')}.csv`;
      document.body.appendChild(a); a.click(); a.remove();
    });
  </script>
</body>
</html>
